platform :ios do
    lane :deploy do
        match(
            type: "appstore",
            readonly: true
        )
        cordova(
            platform: "ios",
            type: "appstore"
        )
        ipa_file = "honesty.store.ipa"
        sh "cp ../platforms/ios/build/device/#{ipa_file} ../"
        pilot(
            distribute_external: false,
            changelog: "Testing TestFlight upload... nothing to see here!"
        )
        sh "rm -f ../#{ipa_file}"
    end

    lane :build do
        sh "cordova platform rm ios"
        sh "cordova prepare ios"
        sh "open ../platforms/ios/honesty.store.xcworkspace"
    end
end
